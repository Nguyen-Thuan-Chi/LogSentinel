<Window x:Class="Log_Sentinel.UI.AlertDetailView"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
xmlns:local="clr-namespace:Log_Sentinel.UI"
        Title="Alert Details" 
        MinHeight="600" 
        MinWidth="800"
        Height="700" 
        Width="900"
        WindowStartupLocation="CenterOwner"
        Background="#FF2B3E50"
        Foreground="White"
        BorderThickness="0"
        FontWeight="Medium"
        TextElement.Foreground="White"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        FontFamily="{DynamicResource MaterialDesignFont}"
        Loaded="Window_Loaded">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- Null/Empty String to Visibility Converter -->
        <local:NullOrEmptyToVisibilityConverter x:Key="NullOrEmptyToVisibilityConverter"/>
        
        <!-- Section Header Style -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
            <Setter Property="Foreground" Value="#FF3498DB"/>
        </Style>
        
        <!-- Field Label Style -->
        <Style x:Key="FieldLabelStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
            <Setter Property="Foreground" Value="#FFE0E0E0"/>
        </Style>
        
        <!-- Read-only TextBox Style -->
        <Style x:Key="ReadOnlyTextBoxStyle" TargetType="TextBox">
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="Background" Value="#FF34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#FF52708B"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                        VerticalScrollBarVisibility="Hidden" 
                                        HorizontalScrollBarVisibility="Hidden"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Multi-line TextBox Style -->
        <Style x:Key="MultiLineTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource ReadOnlyTextBoxStyle}">
            <Setter Property="AcceptsReturn" Value="True"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="MinHeight" Value="80"/>
            <Setter Property="VerticalContentAlignment" Value="Top"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                        VerticalScrollBarVisibility="{TemplateBinding VerticalScrollBarVisibility}" 
                                        HorizontalScrollBarVisibility="Hidden"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- JSON TextBox Style -->
        <Style x:Key="JsonTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource MultiLineTextBoxStyle}">
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="MinHeight" Value="200"/>
            <Setter Property="MaxHeight" Value="400"/>
        </Style>
    </Window.Resources>

    <Grid Margin="25">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Alert Details" 
                   FontSize="28" 
                   FontWeight="Bold" 
                   Margin="0,0,0,20"
                   Foreground="#FF3498DB"
                   HorizontalAlignment="Center"/>

        <!-- Loading Indicator -->
        <ProgressBar Grid.Row="1" 
                     IsIndeterminate="True" 
                     Height="6"
                     Margin="0,0,0,15"
                     Background="#FF34495E"
                     Foreground="#FF3498DB"
                     Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>

        <!-- Error Message -->
        <materialDesign:Card Grid.Row="2" 
                            Padding="20" 
                            Margin="0,0,0,15"
                            Background="#FFE74C3C"
                            Visibility="{Binding ErrorMessage, Converter={StaticResource NullOrEmptyToVisibilityConverter}}">
            <StackPanel>
                <TextBlock Text="? Error" 
                          FontWeight="Bold" 
                          FontSize="14"
                          Foreground="White" 
                          Margin="0,0,0,8"/>
                <TextBlock Text="{Binding ErrorMessage}" 
                          Foreground="White" 
                          TextWrapping="Wrap"
                          FontSize="13"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Content -->
        <ScrollViewer Grid.Row="3" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <StackPanel>
                <!-- Alert Information Card -->
                <materialDesign:Card Padding="25" 
                                    Margin="0,0,0,20"
                                    Background="#FF34495E"
                                    materialDesign:ElevationAssist.Elevation="Dp4">
                    <StackPanel>
                        <TextBlock Text="?? Alert Information" Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="15"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Alert ID -->
                            <StackPanel Grid.Row="0" Grid.Column="0">
                                <TextBlock Text="Alert ID" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding SelectedAlert.Id, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Alert ID"/>
                            </StackPanel>

                            <!-- Rule Name -->
                            <StackPanel Grid.Row="0" Grid.Column="2">
                                <TextBlock Text="Rule Name" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding SelectedAlert.RuleName, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Rule Name"/>
                            </StackPanel>

                            <!-- Severity -->
                            <StackPanel Grid.Row="1" Grid.Column="0">
                                <TextBlock Text="Severity" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding SelectedAlert.Severity, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Severity"/>
                            </StackPanel>

                            <!-- Timestamp -->
                            <StackPanel Grid.Row="1" Grid.Column="2">
                                <TextBlock Text="Timestamp" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding FormattedTimestamp, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Timestamp"/>
                            </StackPanel>

                            <!-- Status -->
                            <StackPanel Grid.Row="2" Grid.Column="0">
                                <TextBlock Text="Status" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding StatusDisplay, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Status"/>
                            </StackPanel>

                            <!-- Acknowledged By -->
                            <StackPanel Grid.Row="2" Grid.Column="2">
                                <TextBlock Text="Acknowledged By" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding AcknowledgedByDisplay, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Acknowledged By"/>
                            </StackPanel>

                            <!-- Title (Full Width) -->
                            <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3">
                                <TextBlock Text="Title" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding SelectedAlert.Title, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Alert Title"/>
                            </StackPanel>

                            <!-- Description (Full Width) -->
                            <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3">
                                <TextBlock Text="Description" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding SelectedAlert.Description, Mode=OneWay}" 
                                        Style="{StaticResource MultiLineTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Alert Description"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Triggering Event Information Card -->
                <materialDesign:Card Padding="25" 
                                    Margin="0,0,0,20"
                                    Background="#FF34495E"
                                    materialDesign:ElevationAssist.Elevation="Dp4">
                    <StackPanel>
                        <TextBlock Text="?? Triggering Event Information" Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="15"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Provider -->
                            <StackPanel Grid.Row="0" Grid.Column="0">
                                <TextBlock Text="Provider" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding TriggeringEvent.Provider, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Provider"/>
                            </StackPanel>

                            <!-- Event ID -->
                            <StackPanel Grid.Row="0" Grid.Column="2">
                                <TextBlock Text="Event ID" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding TriggeringEvent.EventId, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Event ID"/>
                            </StackPanel>

                            <!-- Timestamp -->
                            <StackPanel Grid.Row="1" Grid.Column="0">
                                <TextBlock Text="Timestamp" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding EventTimeFormatted, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Event Timestamp"/>
                            </StackPanel>

                            <!-- Host -->
                            <StackPanel Grid.Row="1" Grid.Column="2">
                                <TextBlock Text="Host" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding TriggeringEvent.Host, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Host"/>
                            </StackPanel>

                            <!-- User -->
                            <StackPanel Grid.Row="2" Grid.Column="0">
                                <TextBlock Text="User" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding TriggeringEvent.User, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="User"/>
                            </StackPanel>

                            <!-- Level -->
                            <StackPanel Grid.Row="2" Grid.Column="2">
                                <TextBlock Text="Level" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding TriggeringEvent.Level, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Event Level"/>
                            </StackPanel>

                            <!-- Process Name -->
                            <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3">
                                <TextBlock Text="Process Name" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding TriggeringEvent.Process, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Process Name"/>
                            </StackPanel>

                            <!-- Action -->
                            <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3">
                                <TextBlock Text="Action" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding TriggeringEvent.Action, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Action"/>
                            </StackPanel>

                            <!-- Object -->
                            <StackPanel Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="3">
                                <TextBlock Text="Object" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding TriggeringEvent.Object, Mode=OneWay}" 
                                        Style="{StaticResource ReadOnlyTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Object"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Event Details JSON Card -->
                <materialDesign:Card Padding="25"
                                    Background="#FF34495E"
                                    materialDesign:ElevationAssist.Elevation="Dp4">
                    <StackPanel>
                        <TextBlock Text="?? Event Details (JSON)" Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <TextBox Text="{Binding EventDetailsFormatted, Mode=OneWay}" 
                                Style="{StaticResource JsonTextBoxStyle}"
                                materialDesign:HintAssist.Hint="Event Details JSON"/>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>
        </ScrollViewer>

        <!-- Close Button -->
        <Button Grid.Row="4" 
                Content="Close" 
                Width="120" 
                Height="40"
                HorizontalAlignment="Right"
                Margin="0,20,0,0"
                Click="CloseButton_Click"
                Background="#FF3498DB"
                Foreground="White"
                BorderThickness="0"
                FontWeight="SemiBold"
                FontSize="14"
                materialDesign:ButtonAssist.CornerRadius="5"
                materialDesign:ElevationAssist.Elevation="Dp2"/>
    </Grid>
</Window>