<UserControl x:Class="Log_Sentinel.UI.DashboardView"
     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
     xmlns:oxy="http://oxyplot.org/wpf"
     xmlns:local="clr-namespace:Log_Sentinel.UI">
<UserControl.Resources>
    <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    <local:BoolToColorConverter x:Key="BoolToColorConverter"/>
    <local:SeverityToColorConverter x:Key="SeverityToColorConverter"/>
</UserControl.Resources>
<Border Background="#F8FAFC" Margin="20">
    <StackPanel>

        <!-- Tiêu đề và Controls -->
        <Grid Margin="0,0,0,20">
            <TextBlock Text="Dashboard" FontSize="26" FontWeight="Bold" HorizontalAlignment="Left"/>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <!-- Refresh Button -->
                <Button Content="🔄 Refresh" 
                        Command="{Binding RefreshCommand}"
                        Background="#2563EB" 
                        Foreground="White" 
                        BorderThickness="0" 
                        Padding="15,8"
                        Cursor="Hand"/>
            </StackPanel>
        </Grid>

        <!-- 3 ô thống kê -->
        <UniformGrid Columns="3" Margin="0,0,0,20">
            <Border Background="#2563EB" CornerRadius="10" Height="60" Margin="5">
                <TextBlock Foreground="White"
                           FontWeight="Bold"
                           FontSize="18"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center">
                    <Run Text="Active Events: "/>
                    <Run Text="{Binding ActiveEventsCount, Mode=OneWay}"/>
                </TextBlock>
            </Border>

            <Border Background="#16A34A" CornerRadius="10" Height="60" Margin="5">
                <TextBlock Foreground="White"
                           FontWeight="Bold"
                           FontSize="18"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center">
                    <Run Text="Rules Active: "/>
                    <Run Text="{Binding ActiveRulesCount, Mode=OneWay}"/>
                </TextBlock>
            </Border>

            <Border Background="#DC2626" CornerRadius="10" Height="60" Margin="5">
                <TextBlock Foreground="White"
                           FontWeight="Bold"
                           FontSize="18"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center">
                    <Run Text="Alerts: "/>
                    <Run Text="{Binding AlertsCount, Mode=OneWay}"/>
                </TextBlock>
            </Border>
        </UniformGrid>

        <!-- User Mode - Charts View -->
        <Grid x:Name="UserModeContainer" 
              Visibility="{Binding IsProfessionalMode, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Invert}">
            <Grid.RowDefinitions>
                <RowDefinition Height="300"/>
                <RowDefinition Height="300"/>
            </Grid.RowDefinitions>
            
            <!-- Alerts Timeline Chart -->
            <Border Grid.Row="0" Background="White" CornerRadius="10" Margin="5" Padding="20" 
                    BorderBrush="#E5E7EB" BorderThickness="1">
                <oxy:PlotView Model="{Binding AlertsTimelineChart}" Height="240"/>
            </Border>
            
            <!-- Top Rules Pie Chart -->
            <Border Grid.Row="1" Background="White" CornerRadius="10" Margin="5" Padding="20"
                    BorderBrush="#E5E7EB" BorderThickness="1">
                <oxy:PlotView Model="{Binding TopRulesChart}" Height="240"/>
            </Border>
        </Grid>

        <!-- Professional Mode - Data Tables View -->
        <Grid x:Name="ProfessionalModeContainer" 
              Visibility="{Binding IsProfessionalMode, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Bảng 1: Recent Events -->
            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                <TextBlock Text="Recent Events"
                           FontSize="20"
                           FontWeight="SemiBold"
                           Margin="0,0,0,8"/>
                <DataGrid ItemsSource="{Binding RecentEvents}"
                          AutoGenerateColumns="False"
                          Height="400"
                          HeadersVisibility="Column"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          BorderBrush="#CBD5E1"
                          BorderThickness="1"
                          AlternatingRowBackground="#F1F5F9">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Event ID" Binding="{Binding EventId}" Width="80"/>
                        <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="2*"/>
                        <DataGridTextColumn Header="Date" Binding="{Binding Date}" Width="120"/>
                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>

            <!-- Bảng 2: Active Rules -->
            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                <TextBlock Text="Active Rules"
                           FontSize="20"
                           FontWeight="SemiBold"
                           Margin="0,0,0,8"/>
                <DataGrid ItemsSource="{Binding ActiveRules}"
                          AutoGenerateColumns="False"
                          Height="400"
                          HeadersVisibility="Column"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          BorderBrush="#CBD5E1"
                          BorderThickness="1"
                          AlternatingRowBackground="#F1F5F9">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Rule ID" Binding="{Binding RuleId}" Width="70"/>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="2*"/>
                        <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="80"/>
                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </Grid>
        </StackPanel>
    </Border>
</UserControl>
